# All LP fees generated by multiple pools can be stolen by a flashloan with zero fee like Balancer or DODO.

## Bug Description
When depositing, price per share does not take consideration of LP fees generated.

```solidity
Price per share = amountForLiquidity / totalSupply
```

Accurate share should be 
```solidity
Price per share = (amountForLiquidity + LP fee generated) / totalSupply
```

A hacker can take following steps to steal all LP fees generated.

- Getting Balancer flashloan for variety of tokens
- For every bunny token
    - Depositing tokens pairs to Uniswap pool
    - Compound
    - Withdraw token pairs
- Repay flashloan
- Take rest as profit

### Difference with known sandwich issues for compound()
Although you might argue it is known sandwitch issue mentioned in README, it's completely different from it.
```
An attacker can perform a sandwich attack on compound calls by submitting the following package of transactions:

- Buy a token from the Uniswap pool underlying the Bunni token
- Compound fees earned by the Bunni token LPs into more liquidity
- Sell the token back for slightly more tokens than started with

This is the result of the intentional design decision to keep compounding permissionless, so there's no perfect solution to it. Realistically it's not going to be a problem since the amount of funds being compounded is usually small (on the same order of magnitude as the gas cost of compounding).
```

Here's are major difference.
- A hacker don't need to wait for compound call and sandwich.

- While monitoring LP fees generated, once sum of LP fees are reaching at thresold, he can launch attack.



## Impact
Here are some examples of Uniswap pairs where you can steal LP fees with Balancer flashloan.
- LDO / WETH
- GHO / USDC
- UNI / WETH
- SGT / WETH
- WBTC / BADGER
- LQTY / WETH

Here are list of tokens you can borrow at Balancer with no fee.
- UNI
- WBTC
- SGT
- BADGER
- GHO
- LDO
- LQTY
- FRAX
- USDC
- PAL
- WETH

## Recommendation

1) Deposit should zero-burn first.

```solidity
    function deposit(DepositParams calldata params)
        external
        payable
        virtual
        override
        checkDeadline(params.deadline)
        returns (
            uint256 shares,
            uint128 addedLiquidity,
            uint256 amount0,
            uint256 amount1
        )
    {
        (uint128 existingLiquidity, , , , ) = params.key.pool.positions(
            keccak256(
                abi.encodePacked(
                    address(this),
                    params.key.tickLower,
                    params.key.tickUpper
                )
            )
        );

+       params.key.pool.burn(params.key.tickLower, params.key.tickUpper, 0);

        (addedLiquidity, amount0, amount1) = _addLiquidity(
            LiquidityManagement.AddLiquidityParams({
                key: params.key,
                recipient: address(this),
                payer: msg.sender,
                amount0Desired: params.amount0Desired,
                amount1Desired: params.amount1Desired,
                amount0Min: params.amount0Min,
                amount1Min: params.amount1Min
            })
        );
        ...
    }
```
2) Price per share should take consideration of LP fees.

```solidity
```